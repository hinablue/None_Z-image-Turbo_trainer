# Z-Image Turbo Trainer

å¤šæ¨¡å‹åŠ é€Ÿ LoRA è®­ç»ƒæ¡†æ¶ï¼Œæ”¯æŒ Z-Imageã€LongCat-Image ç­‰æ¨¡å‹çš„ Turbo/åŠ é€Ÿè®­ç»ƒã€‚

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å®‰è£…é¡¹ç›®
pip install -e .
```

### è¿è¡Œè®­ç»ƒ

```bash
# Z-Image è®­ç»ƒ
python scripts/train_acrf.py --config config/acrf_config.toml

# é€šç”¨åŠ é€Ÿ LoRA è®­ç»ƒï¼ˆæ”¯æŒå¤šæ¨¡å‹ï¼‰
python scripts/train_turbo.py --model_type longcat --dit /path/to/model --config config/longcat_turbo_config.toml
```

## é¡¹ç›®ç»“æ„

```
None_Z-image-Turbo_trainer/
â”œâ”€â”€ config/                          # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ acrf_config.toml             # AC-RF è®­ç»ƒé…ç½®
â”‚   â”œâ”€â”€ style_transfer_config.toml   # é£æ ¼è¿ç§»é…ç½®
â”‚   â”œâ”€â”€ frequency_aware_config.toml  # é¢‘åŸŸæ„ŸçŸ¥é…ç½®
â”‚   â””â”€â”€ longcat_turbo_config.toml    # LongCat åŠ é€Ÿè®­ç»ƒé…ç½®
â”‚
â”œâ”€â”€ scripts/                         # è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ train_acrf.py                # AC-RF è®­ç»ƒï¼ˆZ-Image ä¸“ç”¨ï¼‰
â”‚   â”œâ”€â”€ train_turbo.py               # é€šç”¨åŠ é€Ÿ LoRA è®­ç»ƒ
â”‚   â”œâ”€â”€ train_style_transfer.py      # é£æ ¼è¿ç§»è®­ç»ƒ
â”‚   â””â”€â”€ train_frequency_aware.py     # é¢‘åŸŸæ„ŸçŸ¥è®­ç»ƒ
â”‚
â”œâ”€â”€ src/zimage_trainer/              # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ adapters/                    # ğŸ†• æ¨¡å‹é€‚é…å™¨ï¼ˆå¤šæ¨¡å‹æ”¯æŒï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                  # é€‚é…å™¨æŠ½è±¡åŸºç±»
â”‚   â”‚   â”œâ”€â”€ registry.py              # é€‚é…å™¨æ³¨å†Œè¡¨
â”‚   â”‚   â”œâ”€â”€ zimage_adapter.py        # Z-Image é€‚é…å™¨
â”‚   â”‚   â””â”€â”€ longcat_adapter.py       # LongCat-Image é€‚é…å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ dataset/                     # æ•°æ®é›†å¤„ç†
â”‚   â”‚   â””â”€â”€ dataloader.py            # æ•°æ®åŠ è½½å™¨ + SPDA
â”‚   â”‚
â”‚   â”œâ”€â”€ losses/                      # æŸå¤±å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ frequency_aware_loss.py  # é¢‘åŸŸæ„ŸçŸ¥æŸå¤±
â”‚   â”‚   â””â”€â”€ style_structure_loss.py  # é£æ ¼ç»“æ„æŸå¤±
â”‚   â”‚
â”‚   â”œâ”€â”€ networks/                    # ç½‘ç»œæ¨¡å—
â”‚   â”‚   â””â”€â”€ lora.py                  # LoRA å®ç°
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ zimage_utils.py          # Z-Image å·¥å…·
â”‚   â”‚   â”œâ”€â”€ snr_utils.py             # SNR åŠ æƒ
â”‚   â”‚   â”œâ”€â”€ memory_optimizer.py      # å†…å­˜ä¼˜åŒ–
â”‚   â”‚   â””â”€â”€ hardware_detector.py     # ç¡¬ä»¶æ£€æµ‹
â”‚   â”‚
â”‚   â”œâ”€â”€ acrf_trainer.py              # AC-RF è®­ç»ƒå™¨
â”‚   â”œâ”€â”€ cache_latents.py             # Latent ç¼“å­˜
â”‚   â””â”€â”€ cache_text_encoder.py        # Text Encoder ç¼“å­˜
â”‚
â”œâ”€â”€ webui-vue/                       # Web UI
â”‚   â”œâ”€â”€ api/                         # FastAPI åç«¯
â”‚   â””â”€â”€ src/                         # Vue å‰ç«¯
â”‚
â””â”€â”€ requirements.txt                 # ä¾èµ–
```

## æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### é€‚é…å™¨æ¶æ„ (`src/zimage_trainer/adapters/`)

æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒå¤šç§æ¨¡å‹å…±ç”¨è®­ç»ƒé€»è¾‘ï¼š

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `base.py` | é€‚é…å™¨æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰ç»Ÿä¸€æ¥å£ |
| `registry.py` | é€‚é…å™¨æ³¨å†Œè¡¨ï¼Œæ”¯æŒåç§°/åˆ«åæŸ¥æ‰¾ |
| `zimage_adapter.py` | Z-Image (Turbo) é€‚é…å™¨ |
| `longcat_adapter.py` | LongCat-Image é€‚é…å™¨ |

**æ”¯æŒçš„æ¨¡å‹**ï¼š
- âœ… Z-Image (Turbo) - 10 æ­¥åŠ é€Ÿ
- âœ… LongCat-Image - åŸºäº FLUX æ¶æ„
- ğŸ”œ FLUX - è®¡åˆ’æ”¯æŒ
- ğŸ”œ SD3 - è®¡åˆ’æ”¯æŒ

### è®­ç»ƒè„šæœ¬

| è„šæœ¬ | è¯´æ˜ |
|------|------|
| `train_acrf.py` | AC-RF è®­ç»ƒï¼ŒZ-Image ä¸“ç”¨ï¼ŒåŠŸèƒ½æœ€å®Œæ•´ |
| `train_turbo.py` | ğŸ†• é€šç”¨åŠ é€Ÿè®­ç»ƒï¼Œæ”¯æŒå¤šæ¨¡å‹ |
| `train_style_transfer.py` | é£æ ¼è¿ç§»è®­ç»ƒ |

### æŸå¤±å‡½æ•°

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `frequency_aware_loss.py` | é¢‘åŸŸæ„ŸçŸ¥æŸå¤±ï¼ˆé«˜é¢‘å¢å¼º + ä½é¢‘é”å®šï¼‰ |
| `style_structure_loss.py` | é£æ ¼ç»“æ„æŸå¤±ï¼ˆSSIM + å…‰å½± + è‰²è°ƒï¼‰ |

## é…ç½®è¯´æ˜

### é€šç”¨åŠ é€Ÿé…ç½® (`longcat_turbo_config.toml`)

```toml
[turbo]
turbo_steps = 10          # ç›®æ ‡åŠ é€Ÿæ­¥æ•°
use_anchor = true         # é”šç‚¹é‡‡æ ·
jitter_scale = 0.02       # æŠ–åŠ¨å¹…åº¦

[lora]
network_dim = 32          # LoRA rank
use_peft = true           # ä½¿ç”¨ PEFT åº“

[training]
snr_gamma = 5.0           # Min-SNR åŠ æƒ
```

## æŠ€æœ¯æ ˆ

- **è®­ç»ƒæ¡†æ¶**: PyTorch + Accelerate
- **æ¨¡å‹åº“**: Diffusers, Transformers
- **LoRA**: è‡ªå®šä¹‰å®ç° / PEFT
- **Web UI**: FastAPI + Vue 3 + Element Plus

## ç¯å¢ƒè¦æ±‚

- Python 3.10+
- PyTorch 2.0+
- CUDA 11.8+ (æ¨è)
- 16GB+ VRAM

## æ³¨æ„äº‹é¡¹

1. æœ¬é¡¹ç›®ç”± AI ç”Ÿæˆï¼Œè¯·åœ¨å®é™…ç¯å¢ƒä¸­æµ‹è¯•éªŒè¯
2. åŠ é€Ÿ LoRA è®­ç»ƒæ•ˆæœä¾èµ–æ•°æ®é›†è´¨é‡
3. LongCat é€‚é…å™¨éœ€è¦ LongCat-Image æºç åœ¨ `D:/AI/LongCat-Image`

